match(Pat,Tree) :- match(Pat,Tree,[],Pat,Tree).match(leaf(X),leaf(X),Cont,Pat,Tree) :-	cont(Cont,Pat,Tree).match(leaf(X),leaf(Y),_Cont,Pat,Tree) :- X\== Y,	restart(Pat,Tree).match(var,_,Cont,Pat,Tree) :-	cont(Cont,Pat,Tree).match(leaf(_),tree(_,_,_),_Cont,Pat,Tree) :-	restart(Pat,Tree).match(tree(_,_,_),leaf(_),_Cont,Pat,Tree) :-	restart(Pat,Tree).match(tree(_,X,_),tree(_,Y,_),_Cont,Pat,Tree) :- X\== Y,	restart(Pat,Tree).match(tree(PL,X,PR),tree(TL,X,TR),Cont,Pat,Tree) :- 	match(PL,TL,[(PR,TR)|Cont],Pat,Tree).cont([],_,_).cont([(P,T)|C],Pat,Tree) :- match(P,T,C,Pat,Tree).restart(Pat,tree(L,_,_)) :- match(Pat,L).restart(Pat,tree(_,_,R)) :- match(Pat,R).test(X) :-	match(X,tree(tree(leaf(a),b,leaf(c)),d,tree(leaf(e),f,leaf(g)))).